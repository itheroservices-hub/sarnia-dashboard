# Sarnia Community Dashboard - Deployment Analysis

**Date:** January 18, 2026  
**Target:** sarniacommunitydashboard.com (Namecheap + cPanel)

---

## üéØ Executive Summary

**DEPLOYMENT VERDICT:** This dashboard **CANNOT be deployed as static HTML on cPanel's public_html** alone. It requires a **Node.js runtime environment** for live data updates.

**Recommended Approach:** Hybrid deployment using **Render.com** or **Railway.app** for backend + existing cPanel for optional static assets.

---

## üìä Project Architecture Analysis

### **Frontend Files** (Static - Can Live on cPanel)
```
public/
‚îú‚îÄ‚îÄ index.html          ‚Üê Dashboard entry point
‚îú‚îÄ‚îÄ script.js           ‚Üê Frontend logic (API calls to backend)
‚îú‚îÄ‚îÄ style-dashboard.css ‚Üê Dashboard styling
‚îú‚îÄ‚îÄ events.js           ‚Üê Event handling
‚îú‚îÄ‚îÄ news.json           ‚Üê Generated by backend scraper
‚îú‚îÄ‚îÄ sarnia_events.json  ‚Üê Generated by backend scraper
‚îú‚îÄ‚îÄ via_rail.json       ‚Üê Generated by backend scraper
‚îî‚îÄ‚îÄ assets/             ‚Üê Static images/logos
```

### **Backend Files** (Dynamic - Requires Node.js)
```
server.js                          ‚Üê Express server (PORT 3000)
package.json                       ‚Üê Dependencies (express, axios, puppeteer, etc.)

Scrapers (all run on backend):
‚îú‚îÄ‚îÄ CBSA Scraper/scraper.js        ‚Üê Border wait times
‚îú‚îÄ‚îÄ viarailscraper/railscraper.js  ‚Üê VIA Rail status
‚îú‚îÄ‚îÄ transitscraper/transitscraper.js ‚Üê Sarnia Transit
‚îú‚îÄ‚îÄ sarnia news scraper/           ‚Üê Local news aggregation
‚îú‚îÄ‚îÄ community events scraper/      ‚Üê Community events
‚îî‚îÄ‚îÄ weather scrapers/              ‚Üê Weather data
```

### **Data Files** (Generated by Backend)
```
border_waits.json      ‚Üê Updated every 5 min by CBSA scraper
route_status.json      ‚Üê Updated by transit scraper
transit_times.json     ‚Üê Updated by transit scraper
terminal_map.json      ‚Üê Transit reference data
```

---

## üîç Critical Dependencies

### API Endpoints Required by Frontend

The `script.js` file makes the following **server-side API calls**:

1. **`/api/border-wait`** ‚Üí Serves `border_waits.json`
2. **`/api/via-rail`** ‚Üí Serves `public/via_rail.json`
3. **`/api/events`** ‚Üí Serves `public/sarnia_events.json`
4. **`/transit.json`** ‚Üí Live transit status (dynamic, not cached)
5. **`/weather`** ‚Üí Proxied weather data routes
6. **External:** OpenWeatherMap API (direct from browser)

### Automated Scraper Jobs

The server runs **scheduled scrapers** via `setInterval()`:
- **VIA Rail scraper:** Every 5 minutes
- **CBSA border scraper:** Every 5 minutes
- **Copyright-compliant news scraper:** Every 20 minutes
- **Transit pulse builder:** On-demand via `/transit.json` endpoint

---

## ‚ùå Why Static Deployment Fails

### Problem 1: No API Server
The frontend makes **relative API calls** like:
```javascript
fetch('/api/border-wait')
fetch('/transit.json')
fetch('/weather/today')
```

Without `server.js` running, these return **404 Not Found**.

### Problem 2: No Live Data Updates
The scrapers **write to JSON files** that the server then serves. On cPanel:
- No Node.js process to run scrapers
- JSON files would become stale immediately
- Dashboard would display outdated data (violates requirement)

### Problem 3: Puppeteer Dependency
VIA Rail scraper uses **Puppeteer** (headless Chrome), which:
- Requires a Node.js environment
- Needs system-level dependencies (Chromium)
- Cannot run on shared cPanel hosting

---

## ‚úÖ Recommended Deployment Strategy

### **Option 1: Full Deployment on Render.com (Recommended)**

**Pros:**
- Free tier available
- Built-in Node.js support
- Auto-deploy from Git
- HTTPS by default
- Persistent storage for JSON files
- Supports scheduled jobs (via cron or intervals)

**Steps:**
1. Push project to GitHub (private repo)
2. Connect Render to repo
3. Set build command: `npm install`
4. Set start command: `npm start`
5. Configure environment variables (if needed)
6. Point domain `sarniacommunitydashboard.com` to Render via CNAME

**Monthly Cost:** $0 (Free tier) or $7/month (Starter for custom domain)

---

### **Option 2: Railway.app**

**Pros:**
- $5/month credit on free tier
- Automatic HTTPS
- GitHub integration
- Good for Node.js apps

**Setup:**
- Same as Render (push to Git, configure start script)
- Point domain via CNAME

---

### **Option 3: Hybrid (cPanel + Render)**

**Use cPanel for:**
- Static assets (`assets/` folder)
- Redirect root domain to Render app

**Use Render for:**
- Full Node.js backend
- API endpoints
- Scrapers

**Why this might not be ideal:**
- Adds complexity
- CORS issues if not configured properly
- No real cost savings

---

## üöÄ Deployment Checklist (Render)

### Pre-Deployment Tasks
- [ ] Create GitHub repository (private)
- [ ] Add `.gitignore` (exclude `node_modules/`, `.env`)
- [ ] Test locally: `npm install && npm start`
- [ ] Verify all scrapers run without errors
- [ ] Check port binding (use `process.env.PORT`)

### Render Setup
- [ ] Create Render account
- [ ] Create new Web Service
- [ ] Connect GitHub repo
- [ ] Set environment: Node
- [ ] Build command: `npm install`
- [ ] Start command: `node server.js`
- [ ] Set PORT environment variable (Render auto-assigns)
- [ ] Deploy

### Domain Configuration
- [ ] Get Render app URL (e.g., `sarnia-dashboard.onrender.com`)
- [ ] In Namecheap DNS, add CNAME:
  ```
  Type: CNAME Record
  Host: @
  Value: sarnia-dashboard.onrender.com
  TTL: Automatic
  ```
- [ ] In Render, add custom domain: `sarniacommunitydashboard.com`
- [ ] Wait for SSL certificate provisioning (automatic)

### Post-Deployment Verification
- [ ] Test all API endpoints
- [ ] Verify scrapers are running (check logs)
- [ ] Confirm data updates every 5-20 minutes
- [ ] Test on mobile and desktop
- [ ] Monitor for errors in Render logs

---

## üìù Required Code Changes

### 1. Update `server.js` Port Binding
**Current:**
```javascript
const PORT = process.env.PORT || 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`üöÄ Server running at http://192.168.2.38:${PORT}`);
});
```

**Change to:**
```javascript
const PORT = process.env.PORT || 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`üöÄ Server running on port ${PORT}`);
});
```

### 2. Fix CBSA Scraper Import (if needed)
Check if `runScraper` function is properly exported and imported in `server.js`.

**Current (line 35-36):**
```javascript
// const { runScraper } = require('./CBSA Scraper/scraper');
// const { runEventsScraper } = require('./community events scraper/scraper');
```

**These are commented out.** Either:
- Uncomment and ensure proper exports, OR
- Remove the `setInterval(runScraper, 5 * 60 * 1000);` call on line 149

### 3. Create `.gitignore`
```
node_modules/
.env
*.log
.DS_Store
```

### 4. Create `.env` (if API keys needed)
**Example:**
```
OPENWEATHER_API_KEY=358109cc7c1d67419364bfdde1dbc335
PORT=3000
```

**Then update `script.js` to read from server-side endpoint instead of hardcoded key.**

---

## ‚ö†Ô∏è Potential Issues & Solutions

### Issue 1: Puppeteer on Render
**Problem:** Puppeteer requires Chromium, which may not be in Render's default image.

**Solution:** Add to `package.json`:
```json
"scripts": {
  "build": "npm install && npx puppeteer browsers install chrome"
}
```

Or use `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true` and install manually.

### Issue 2: File Persistence
**Problem:** JSON files written by scrapers may be lost on restart (Render uses ephemeral storage).

**Solution:** 
- Use Render's persistent disk ($1/GB/month), OR
- Store data in a database (MongoDB Atlas free tier), OR
- Accept that data regenerates on restart (scrapers run immediately on startup)

**Recommendation:** For this project, ephemeral storage is fine since scrapers run every 5-20 minutes.

### Issue 3: Scraper Failures
**Problem:** CBSA or VIA Rail scrapers may fail if websites change structure.

**Solution:**
- Add error handling (already present)
- Log errors to Render console
- Implement fallback data or "Data temporarily unavailable" messages

---

## üí∞ Cost Analysis

### Current (cPanel Only)
- **Cost:** Included with domain ($10-15/year)
- **Problem:** Cannot run Node.js (unless VPS upgrade ~$30/month)

### Render.com Free Tier
- **Cost:** $0/month
- **Limitations:**
  - Sleeps after 15 min inactivity (wakes on request)
  - 750 hours/month (sufficient for 24/7 operation)
  - No custom domain on free tier
  - 512 MB RAM

### Render.com Starter ($7/month)
- **Cost:** $7/month
- **Benefits:**
  - Always-on (no sleep)
  - Custom domain support
  - 512 MB RAM
  - 100 GB bandwidth/month

### Railway ($5/month credit)
- **Cost:** Pay-as-you-go (~$5-10/month)
- **Benefits:**
  - $5 free credit monthly
  - Custom domains
  - No sleep

---

## üé¨ Next Steps

### Immediate Actions:
1. **Create GitHub repository** for version control
2. **Fix commented-out scraper imports** in `server.js`
3. **Test locally** to ensure all scrapers work
4. **Create Render account** and deploy
5. **Configure custom domain** in Namecheap DNS

### Estimated Timeline:
- **GitHub setup:** 15 minutes
- **Code fixes:** 30 minutes
- **Render deployment:** 30 minutes
- **Domain DNS propagation:** 24-48 hours
- **Total:** ~1-2 days for full deployment

---

## üìû Support Resources

- **Render Docs:** https://render.com/docs
- **Railway Docs:** https://docs.railway.app
- **Namecheap DNS Guide:** https://www.namecheap.com/support/knowledgebase/article.aspx/767/10/how-to-change-dns-for-a-domain

---

## ‚ú® Conclusion

Your Sarnia Community Dashboard is a **dynamic, real-time application** that requires a Node.js backend. It cannot be deployed as static HTML on cPanel alone.

**Recommended path forward:**
1. Deploy to **Render.com** (free tier to start)
2. Point `sarniacommunitydashboard.com` to Render via CNAME
3. Monitor performance and upgrade to paid tier if needed for always-on availability

This approach ensures:
- ‚úÖ Live data updates every 5-20 minutes
- ‚úÖ All scrapers run automatically
- ‚úÖ Professional uptime and performance
- ‚úÖ HTTPS by default
- ‚úÖ Easy updates via Git push

Let me know when you're ready to proceed with deployment, and I'll guide you through each step! üöÄ
